# MATLAB Directory

It contains all MATLAB scripts along with the Simulink models required for the project.

Here is a brief description of the folders:

- `Datas`: Contains the data files used for the project. This includes original data files (from SWEC-ETHZ) and the statistics generated by the MATLAB scripts. Was not uploaded because of the size of the files, its structure is as follows:
    - `ID*`: Contains the data for one patient.
        - `Sz*.mat`: Contains the data for one seizure.
        - `*_stats.csv`: Files generated by `generate_wavelets.m` containing the statistics for the training or testing.
- `hdlsrc`: Contains the HDL files generated by the HDL Coder.
- `simulink`: Contains the Simulink models used for the project.
- `svm_models`: Contains the SVM models generated by the MATLAB app Classification learner.

Now the MATLAB scripts:

- `clear_table.m`: File used to clear the table when computing the statistics.
- `compute_stats.m`: Computes the statistics for one signal.
- `conversion_svm.m`: Generates the SVM models for the C code.
- `fpga_output_id*.mat`: Saved output of the FPGA for the different signals.
- `generate_epochs_from_EGG.m`: For one seizure, generates the epochs from the EGG signal.
- `generate_stats.m`: For one epoch, generates the statistics.
- `generate_wavelets.m`: Generate statistics for all seizures.
- `pauses.m`: Pause function found on the Internet, better than the default one.
- `plot_fpga_results.m`: Plots the results of the FPGA.
- `rs232_com.m`: Communication with the FPGA.
- `test_classifier.m`: Checks the accuracy of the SVM model using the MATLAB version.
- `test_simulink.m`: Checks the accuracy of the SVM model using the Simulink version.
- `tmp.m`: Just a temporary file to do some tests.


## How to use the scripts
First one needs to run generate_wavelets.m to generate the statistics for all the seizures. In this file, one can choose which seizures to use for the training and which ones to use for the testing. Just change the variable `num_training_all` to the desired value, if one set it to say 3, then the first 3 seizures will be used for the training and the rest for the testing. This will generate a file called `training_stats.csv` which contains all the training statistics and for each test seizure, a file called `testing_stats_sz*.csv` which contains the test statistics. The will be saved in the folder `Datas/ID*`. This can take some time, less than 3 hours for sure but I don't know the precise duration.

Then, one can open the MATLAB app called "Classification Learner". In this app, one can load the training statistics and train the SVM models. The classification costs and features I used are all found in the appendices of my report. Once the model is trained, one can export it to the workspace.

Then, one can run the script `test_classifier.m` to check the accuracy of the model. This script will load the test statistics and the SVM model and will compute the accuracy of the model for one chosen seizure. It gives the number of true positives, true negatives, false positives and false negatives, which can be used to compute the accuracy. It will also plot the results along with the actual start and end of the seizure this allows to manually find the delay between the actual seizure and the detected seizure.

The script `test_simulink.m` will run similar test but using the build full_system to check the accuracy of the model. It will load the chosen seizure and the SVM model and will compute the accuracy of the model. It will also plot the results along with the actual start and end of the seizure this allows to manually find the delay between the actual seizure and the detected seizure.

The script `conversion_svm.m` will load the SVM model and will generate the C code for the SVM model. The code is just displayed in the command window, one can copy it and paste it in the file `main.c` in the folder `FPGA/id*/nios/application/` and replace the code that is already there. Then, one can run the NIOS II software and the FPGA to check the accuracy of the model. The README.md in the folder `FPGA/` explains how to do this.

The script `rs232_com.m` is used to communicate with the FPGA. It is to be run after the FPGA is running. It will load the chosen seizure and will compute the accuracy of the model. It will also plot the results along with the actual start and end of the seizure this allows to manually find the delay between the actual seizure and the detected seizure.