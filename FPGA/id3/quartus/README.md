# This directory contains the source code for the FPGA testing.

When creatig a new project, add in the `hdl` folder all the files from the `MATLAB/hdlsrc` directory, an interface file for the predictor (can copy `predictor_interface.vhd` from another project) and the `top_level.vhd` file. Some comments in both of these files from this project explain how to change them to adapt them to the new project.

Then a Quartus (I used Quartus 17.1) project can be created in this directory, when creating it choose the correct device family (I used Cyclone IV E) and the correct device (I used EP4CE115F29C7). Then add all the files from the `hdl` folder to the project. The `top_level.vhd` has to be set as the Top Level Entity (right-click it in the files naivgator and click the correct option).
In the menu `Assignments` -> `Import Assignments...` select the `DE2_115_pin_assignments.csv` file to import the pin assignments. 

Then, a QSys system can be created. To do so, in the menu `Tools` -> `Qsys` click `New...`. Saved it in the directory `quartus` with the name system. Then add a Nios II Processor, On-chip Memory (with at least 128k of memory), the JTAG UART, the RS-232 UART, some PIOs for the LEDs. Create a new component from the generated files by HDL Coder and add it to the system. Then connect all the components together. Finally save the system, no need to generate it.
In the new system directory, you can find `system_inst.vhd` which should be instanciated in the `top_level.vhd` file. The `system.qip` file should be added to the Quartus project.

Then the project can be compiled. If there are no errors, the project can be programmed on the FPGA. To do so, connect the DE2-115 board to the computer via the USB Blaster port. Then in the menu `Tools` -> `Programmer` select the correct hardware (should be `USB-Blaster [USB-0]`). The FPGA should be detected and the `Hardware Setup` window should show the correct device. Then in the `File` menu select the `.sof` file generated by Quartus and click `Start`. The FPGA should be programmed.

Note that the generated code uses some Intel Megafunctions, it means the files created by quartus can only be used in a limited time. When I did the project, it was only one hour. So if you want to use the code for a longer time, you have to generate the files again.

Once all this is done, leave all Quartus windows open and launch Eclipse for Nios from `Tools` -> `Nios II Software Build Tools for Eclipse`. The README.md file in the `nios` folder explains how to test the system on the FPGA.